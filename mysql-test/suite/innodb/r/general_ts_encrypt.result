call mtr.add_suppression("Partition.*does not exist in the InnoDB internal data dictionary though");
CREATE TABLESPACE ts_invalid1 ADD DATAFILE 'ts_invalid1.ibd' ENCRYPTION='12345';
ERROR HY000: Invalid encryption option.
CREATE TABLESPACE ts_valid2 ADD DATAFILE 'ts_valid2.ibd' ENCRYPTION='';
CREATE TABLESPACE ts_invalid3 ADD DATAFILE 'ts_invalid3.ibd' ENCRYPTION='_';
ERROR HY000: Invalid encryption option.
CREATE TABLESPACE ts_encrypted ADD DATAFILE 'ts_encrypted.ibd' ENCRYPTION="Y" ENGINE="InnoDB";
CREATE TABLESPACE ts_unencrypted ADD DATAFILE 'ts_unencrypted.ibd' ENGINE="InnoDB";
CREATE TABLE t1 (a TEXT) TABLESPACE ts_encrypted ENGINE="InnoDB";
DROP TABLE t1;
CREATE TABLE t2 (a TEXT) TABLESPACE ts_unencrypted ENGINE="InnoDB";
INSERT INTO t2 (a) VALUES ('ONE'), ('TWO'), ('THREE');
CREATE TABLE t3 (a TEXT) TABLESPACE ts_encrypted  ENGINE="InnoDB";
INSERT INTO t3 (a) VALUES ('ONE'), ('TWO'), ('THREE');
CREATE TABLE t3_1 (a TEXT) TABLESPACE ts_encrypted ENCRYPTION="Y"  ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE t4 (a TEXT) TABLESPACE ts_unencrypted ENCRYPTION="Y" ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE t5 (a TEXT) TABLESPACE ts_encrypted ENCRYPTION="N" ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE t6 (a TEXT) TABLESPACE ts_unencrypted ENGINE="InnoDB";
INSERT INTO t6 (a) VALUES ('ONE'), ('TWO'), ('THREE');
CREATE TABLE t6_1 (a TEXT) TABLESPACE ts_unencrypted ENCRYPTION="N" ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE t6_2 (a TEXT) TABLESPACE ts_unencrypted ENGINE="InnoDB";
ALTER TABLE t2 ENCRYPTION='Y';
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
ALTER TABLE t3 ENCRYPTION='N';
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
ALTER TABLE t6 ENCRYPTION='Y';
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
ALTER TABLE t2 TABLESPACE ts_encrypted;
ALTER TABLE t3 TABLESPACE ts_unencrypted;
ERROR HY000: Source tablespace is encrypted but target tablespace is not.
ALTER TABLE t6 TABLESPACE ts_encrypted;
CREATE TABLESPACE ts_encrypted_new ADD DATAFILE 'ts_encrypted_new.ibd' ENCRYPTION="Y" ENGINE="InnoDB";
CREATE TABLESPACE ts_unencrypted_new ADD DATAFILE 'ts_unencrypted_new.ibd' ENGINE="InnoDB";
ALTER TABLE t2 TABLESPACE ts_unencrypted_new;
ERROR HY000: Source tablespace is encrypted but target tablespace is not.
ALTER TABLE t3 TABLESPACE ts_encrypted_new;
ALTER TABLE t6 TABLESPACE ts_unencrypted_new;
ERROR HY000: Source tablespace is encrypted but target tablespace is not.
CREATE TABLE p1 (a TEXT) TABLESPACE=innodb_system ENGINE="InnoDB";
CREATE TABLE p2 (a TEXT) TABLESPACE=innodb_system ENCRYPTION="N" ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE p3 (a TEXT) TABLESPACE=innodb_system ENCRYPTION="Y" ENGINE="InnoDB";
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
ALTER TABLE t2 TABLESPACE innodb_system;
ERROR HY000: Source tablespace is encrypted but target tablespace is not.
ALTER TABLE t3 TABLESPACE innodb_system;
ERROR HY000: Source tablespace is encrypted but target tablespace is not.
ALTER TABLE t6_2 TABLESPACE innodb_system;
SET GLOBAL innodb_file_per_table=0;
CREATE TABLE t7 (a TEXT) ENGINE='InnoDB';
CREATE TABLE t8 (a TEXT) ENCRYPTION='y' ENGINE='InnoDB';
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
CREATE TABLE t9 (a TEXT) ENCRYPTION='n' ENGINE='InnoDB';
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
SET GLOBAL innodb_file_per_table=1;
CREATE TABLE t10 (a TEXT) ENGINE='InnoDB';
CREATE TABLE t11 (a TEXT) ENCRYPTION='y' ENGINE='InnoDB';
CREATE TABLE t12 (a TEXT) ENCRYPTION='n' ENGINE='InnoDB';
CREATE TABLE pt1 (a INT NOT NULL, PRIMARY KEY(a))
ENGINE=InnoDB TABLESPACE ts_unencrypted
PARTITION BY RANGE (a) PARTITIONS 3 (
PARTITION p1 VALUES LESS THAN (20),
PARTITION p2 VALUES LESS THAN (40) TABLESPACE innodb_file_per_table,
PARTITION p3 VALUES LESS THAN (60) TABLESPACE innodb_system);
ERROR HY000: InnoDB : A partitioned table is not allowed in a shared tablespace.
CREATE TABLE pt2 (a INT NOT NULL, PRIMARY KEY(a))
ENGINE=InnoDB TABLESPACE ts_encrypted ENCRYPTION='y'
	PARTITION BY RANGE (a) PARTITIONS 3 (
PARTITION p1 VALUES LESS THAN (20),
PARTITION p2 VALUES LESS THAN (40) TABLESPACE innodb_file_per_table,
PARTITION p3 VALUES LESS THAN (60) TABLESPACE ts_encrypted_new);
ERROR HY000: InnoDB : A partitioned table is not allowed in a shared tablespace.
CREATE TABLE spt1 (a INT NOT NULL, b INT)
ENGINE=InnoDB TABLESPACE ts_unencrypted
PARTITION BY RANGE (a) PARTITIONS 3 SUBPARTITION BY KEY (b) (
PARTITION p1 VALUES LESS THAN (20) (
SUBPARTITION p11 TABLESPACE ts_unencrypted,
SUBPARTITION p12 TABLESPACE innodb_file_per_table,
SUBPARTITION p13 TABLESPACE ts_unencrypted_new),
PARTITION p2 VALUES LESS THAN (40) TABLESPACE innodb_file_per_table (
SUBPARTITION p21 TABLESPACE ts_unencrypted,
SUBPARTITION p22 TABLESPACE innodb_file_per_table,
SUBPARTITION p23 TABLESPACE ts_unencrypted_new),
PARTITION p3 VALUES LESS THAN (60) TABLESPACE innodb_system (
SUBPARTITION p31 TABLESPACE ts_unencrypted,
SUBPARTITION p32 TABLESPACE innodb_file_per_table,
SUBPARTITION p33 TABLESPACE ts_unencrypted_new));
ERROR HY000: InnoDB : A partitioned table is not allowed in a shared tablespace.
CREATE TABLE spt2 (a INT NOT NULL, b INT)
ENGINE=InnoDB TABLESPACE ts_encrypted ENCRYPTION='y'
	PARTITION BY RANGE (a) PARTITIONS 3 SUBPARTITION BY KEY (b) (
PARTITION p1 VALUES LESS THAN (20) (
SUBPARTITION p11 TABLESPACE ts_encrypted,
SUBPARTITION p12 TABLESPACE innodb_file_per_table,
SUBPARTITION p13 TABLESPACE ts_encrypted_new),
PARTITION p2 VALUES LESS THAN (40) TABLESPACE innodb_file_per_table (
SUBPARTITION p21 TABLESPACE ts_encrypted,
SUBPARTITION p22 TABLESPACE innodb_file_per_table,
SUBPARTITION p23 TABLESPACE ts_encrypted_new),
PARTITION p3 VALUES LESS THAN (60) TABLESPACE ts_encrypted_new (
SUBPARTITION p31 TABLESPACE ts_encrypted,
SUBPARTITION p32 TABLESPACE innodb_file_per_table,
SUBPARTITION p33 TABLESPACE ts_encrypted_new));
ERROR HY000: InnoDB : A partitioned table is not allowed in a shared tablespace.
SET GLOBAL innodb_file_per_table=OFF;
SET SESSION innodb_strict_mode=OFF;
CREATE TABLE q1 (c1 int);
ALTER TABLE q1 ENCRYPTION='Y',ALGORITHM=COPY;
ERROR HY000: InnoDB : ENCRYPTION is not accepted syntax for CREATE/ALTER table, for tables in general/shared tablespace.
SET GLOBAL innodb_file_per_table=1;
DROP TABLE t2;
DROP TABLE t3;
DROP TABLE t6;
DROP TABLE t6_2;
DROP TABLE t7;
DROP TABLE t10;
DROP TABLE t11;
DROP TABLE t12;
DROP TABLE q1;
DROP TABLE p1;
DROP TABLESPACE ts_encrypted;
DROP TABLESPACE ts_encrypted_new;
DROP TABLESPACE ts_unencrypted;
DROP TABLESPACE ts_unencrypted_new;
DROP TABLESPACE ts_valid2;
