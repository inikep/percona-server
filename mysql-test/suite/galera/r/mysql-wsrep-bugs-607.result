#
# test the order of wsrep XID storage after certifiation failure
#
set session wsrep_sync_wait=0;
create table t1 (i int primary key, j int);
insert into t1 values (4, 0);
set session wsrep_sync_wait=0;
SET GLOBAL debug = "d,sync.wsrep_apply_cb";
UPDATE test.t1 set j=1 where i=4;
SET SESSION DEBUG_SYNC = "now WAIT_FOR sync.wsrep_apply_cb_reached";
set session wsrep_sync_wait=0;
set session wsrep_retry_autocommit=0;
UPDATE test.t1 SET j=2  WHERE i=4;
SET DEBUG_SYNC = "now SIGNAL signal.wsrep_apply_cb";
SET GLOBAL debug = "";
SET DEBUG_SYNC = "RESET";
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
select * from t1;
i	j
4	1
DROP TABLE t1;
