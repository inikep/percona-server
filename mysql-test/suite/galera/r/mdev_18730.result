CREATE TABLE t1 (f1 INT PRIMARY KEY);
SET DEBUG_SYNC = "wsrep_after_commit_order_leave SIGNAL acol_reached WAIT_FOR acol_continue";
INSERT INTO t1 VALUES (1);
SET DEBUG_SYNC = "now WAIT_FOR acol_reached";
SET SESSION wsrep_sync_wait = 0;
SET SESSION wsrep_trx_fragment_unit = 'rows';
SET SESSION wsrep_trx_fragment_size = 1;
START TRANSACTION;
INSERT INTO t1 VALUES (2);
SET DEBUG_SYNC = "now SIGNAL acol_continue";
ROLLBACK;
SET DEBUG_SYNC = "RESET";
SET DEBUG_SYNC = "wsrep_after_commit_order_leave SIGNAL acol_reached WAIT_FOR acol_continue";
INSERT INTO t1 VALUES (3);
SET DEBUG_SYNC = "now WAIT_FOR acol_reached";
SET SESSION wsrep_sync_wait = 0;
SET SESSION wsrep_trx_fragment_unit = 'rows';
SET SESSION wsrep_trx_fragment_size = 1;
START TRANSACTION;
INSERT INTO t1 VALUES (4);
SET DEBUG_SYNC = "now SIGNAL acol_continue";
ROLLBACK;
SET DEBUG_SYNC = "RESET";
DROP TABLE t1;
