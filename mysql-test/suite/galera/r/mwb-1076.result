SET GLOBAL wsrep_applier_threads=2;
CREATE TABLE t1 (
id INTEGER PRIMARY KEY,
f2 INTEGER);
CREATE TABLE t2 (
f1 INT PRIMARY KEY,
t1_id INT NOT NULL,
f2 INTEGER NOT NULL,
KEY key_t1_id(t1_id),
CONSTRAINT key_t1_id FOREIGN KEY (t1_id) REFERENCES t1 (id) ON UPDATE CASCADE ON DELETE CASCADE);
INSERT INTO t1 VALUES (1,0);
INSERT INTO t1 VALUES (2,0);
INSERT INTO t2 VALUES (1,1,1234);
INSERT INTO t2 VALUES (2,2,1234);
SET GLOBAL DEBUG = "d,sync.wsrep_apply_toi";
ALTER TABLE t1 CHANGE f2 f2 LONGTEXT;
SET DEBUG_SYNC = "now WAIT_FOR sync.wsrep_apply_toi_reached";
SET SESSION wsrep_sync_wait = 0;
UPDATE t2 SET f2 = 1 WHERE f1=2;
SET DEBUG_SYNC = "now SIGNAL signal.wsrep_apply_toi";
SET GLOBAL DEBUG = 'RESET';
SET GLOBAL wsrep_applier_threads = DEFAULT;
DROP TABLE t2,t1;
