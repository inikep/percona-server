CREATE TABLE t1 (f1 INTEGER PRIMARY KEY);
SET SESSION wsrep_trx_fragment_size=1;
START TRANSACTION;
INSERT INTO t1 VALUES (1);
SELECT COUNT(*) `Expect 1` FROM mysql.wsrep_streaming_log;
Expect 1
1
SET @@global.debug="+d,ha_index_init_fail";
ROLLBACK;
SET SESSION wsrep_sync_wait = 0;
SELECT COUNT(*) `Expect 0` FROM mysql.wsrep_streaming_log;
Expect 0
0
SET @@global.debug="";
SET SESSION wsrep_sync_wait = 0;
SELECT COUNT(*) `Expect 1` FROM mysql.wsrep_streaming_log;
Expect 1
1
# restart
SELECT COUNT(*) `Expect 0` FROM mysql.wsrep_streaming_log;
Expect 0
0
DROP TABLE t1;
CALL mtr.add_suppression("WSREP: Failed to init table for index scan");
CALL mtr.add_suppression("Failed to apply write set");
CALL mtr.add_suppression("Failed to report last committed");
