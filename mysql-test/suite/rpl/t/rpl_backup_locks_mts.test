###########################################################################
# MTS tests for binlog backup locks
###########################################################################

--source include/master-slave.inc

--connection master
CREATE DATABASE db_1;
CREATE DATABASE db_2;

CREATE TABLE db_1.test_1 (id INTEGER);
CREATE TABLE db_2.test_1 (id INTEGER);

--connection master
--source include/sync_slave_sql_with_master.inc

--connection slave

--source include/stop_slave.inc

SET @save.slave_parallel_workers= @@GLOBAL.slave_parallel_workers;
SET @@GLOBAL.slave_parallel_workers= 2;

--source include/start_slave.inc
# Process the injected relay log Format_description_log_event before binlog is locked
--connection master
INSERT INTO db_1.test_1 VALUES(2);
--source include/sync_slave_sql_with_master.inc

--connection master
--source include/sync_slave_sql_with_master.inc

--connection master
DROP DATABASE db_1;
DROP DATABASE db_2;

--source include/sync_slave_sql_with_master.inc

SET @@GLOBAL.slave_parallel_workers= @save.slave_parallel_workers;

--source include/rpl_end.inc
